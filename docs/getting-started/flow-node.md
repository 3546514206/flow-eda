# 功能节点

在绘图区域的左侧有一条含有很多节点的列表，我们把这些节点称之为“功能节点”。

功能节点会随着项目的不断迭代开发而扩展变化，根据其功能特点分为不同的节点类型，在节点列表区域可以展开和折叠同类型的节点。

### 节点输入/输出

每个节点都有一个输入参数和一个输出参数，节点每次运行时，都是从输入参数中获取数据，进行特殊逻辑处理后，将结果设置到输出参数中。

- 输入：若某个节点没有上游节点，则它的输入参数为该节点自己的属性参数；若该节点有上游节点，则它的输入参数为上游节点的输出参数加上它自己的节点属性参数。
- 输出：当前节点的输出参数是根据输入参数进行逻辑处理后的结果。

> 节点的输入输出参数统一为 json 格式的数据。

### 节点性质类型

所有的功能节点，根据节点运行特性分为以下几大类：

- 起始节点：在一个流程中，起始节点是标志流程开始的节点，整个流程是从起始节点开始执行的。例如开始、定时器等节点就是起始节点。
- 普通节点：泛指没有特殊性质的节点，这类节点往往功能简单，由上游节点触发执行，执行完成该节点就运行结束了。例如数据库类的节点。
- 输出节点：当运行流程时需要查看运行结果或者输出参数，就需要有输出节点来专门负责查看输出内容。目前仅有[输出]节点有此功能。
- 阻塞节点：当流程正常运行时，有些节点无法立即运行完成，需要一直处于运行中状态等待，这类节点为阻塞节点，会阻塞当前流程的执行。例如 WS 服务端等节点。

阻塞节点一般在流程运行时会一直处于运行中状态，阻塞整个流程继续向下运行，往往无法自行停止或切换运行状态，这是由于其功能的特殊性需要一直处于监听状态导致的。
除定时器、延时器等有终止条件的节点外，其他阻塞节点都是无法自行停止的。

> 当用户想要主动停止阻塞节点时，可以点击工具栏的停止按钮来中止流程。

下面我们将对功能节点进行一一介绍。

### 开始节点

开始节点是触发流程执行的起始节点，一个流程图中不限制开始节点的数量。
运行流程时，当前流程中所有的开始节点会同时运行，每个开始节点仅会运行一次。

**节点参数：**
无

### 定时器节点

定时器节点可作为起始节点，用于定时触发流程周期性执行，支持周期触发和 cron 表达式，可指定执行次数，可输出指定格式的时间戳；
亦可作为非起始节点，由上游节点触发执行。

> 定时器节点作为起始节点时，在流程开始运行时会立即执行一次。

**节点参数：**

- 执行周期<font color=red>\*</font>：指每次触发执行的时间间隔，采用填写数值+选择单位的方式，可以让用户灵活的填写执行周期。支持 cron 表达式
- 执行次数<font color=red>\*</font>：指定时触发的总执行次数，0 表示不限制次数，永久执行。
- 输出时间：用户可以选择输出时间的格式，不选择则不输出时间。选定格式后，本节点每次运行时都会输出对应格式的时间值，字段名为`timestamp`。

### 延时器节点

延时器节点用于延迟执行，可设定延迟时间，等待延迟时间过后再触发下游节点执行。

**节点参数：**

- 延迟时间<font color=red>\*</font>：指需要延迟多长时间，采用填写数值+选择单位的方式，用户可以灵活指定延迟时间。

### 输出节点

输出节点主要用于展示输出内容，当其上游节点运行完成后，节点的输出参数就会传递至输出节点，再由输出节点进行实时展示。
方便用户实时查看各个节点的输出参数内容。输出节点由上游节点触发执行，触发后立即执行完成，展示最新的输出信息，会覆盖之前的输出信息。

> 输出节点可将上游节点的输出信息完整地传递至下游节点。

**节点参数：**
无

### 条件节点

条件节点主要用于判断条件是否满足，用户可根据上游节点的参数值进行判断，条件满足后才会继续向下游节点执行输出，若条件不满足则不继续执行，
可使用多个条件节点组成与或等逻辑通路。

**节点参数：**

- 字段名<font color=red>\*</font>：指从上游节点的输出参数中取哪个字段进行判断，此处填写字段名，若输出参数有多层结构，可使用 a.b.c 的格式获取，仅支持填写单个字段名，不支持多个字段。
- 判断逻辑<font color=red>\*</font>：指需要对目标字段做什么判断，等于或不等于、大于小于之类的各种判断逻辑可供用户选择。
- 判断值<font color=red>\*</font>：指期望目标字段在对应逻辑下的值，和逻辑判断组合使用，例如=xxx、>1 等等。支持填写 null，表示目标字段不存在（存在）或者值为（不为） NULL。

### 序列节点

序列节点主要用于输出整数序列，可自定义序列的间隔大小和数字范围，可选择步进方式为递增或递减，该节点会依次输出整数序列。

**节点参数：**

- 初始值<font color=red>\*</font>：指生成序列的初始值，即序列的起点，只能为整数，生成的序列包含此值。
- 结束值<font color=red>\*</font>：指生成序列的结束值，即序列的终点，只能为整数，生成的序列包含此值。
- 递进方式：指序列递进的方式，可选择递增或递减，默认为递增。
- 递进间隔：指序列递进的数字间隔大小，只能输入大于 0 的整数，默认值为 1。

### 拼接节点

拼接节点主要用于拼接多个分散的值，可以在一定时间内多次持续地接收上游节点的输出参数，对用户指定字段的值进行拼接，默认使用逗号分隔拼接的值。
接收值并拼接完成后，会向下游节点输出一个`result`字段，其值就是拼接后的值。

**节点参数：**

- 字段名<font color=red>\*</font>：指从上游节点的输出参数中取哪个字段进行取值，此处填写字段名，若输出参数有多层结构，可使用 a.b.c 的格式获取，仅支持填写单个字段名，不支持多个字段。
- 是否过滤空值：指拼接值的时候，若某次接收到的值为空，用户可以选择是否将其过滤掉，默认过滤空值。

> 拼接节点接收上游节点的输出进行拼接，超过 200ms 未继续收到输出则会结束接收。

### 分割节点

分割节点主要用于分割指定的字段或列表，从上游节点的输出参数中取一个字段进行分割，当指定字段是一个列表时，会将列表分割开；
当指定字段的值是一个字符串时，可以根据用户自定义的分割符进行分割，分割结束后输出分割结果，输出字段名为`result`。
用户可以指定输出方式，可以连续输出多次，每次输出单个元素值；也可以仅输出一次，输出值为一个数组。

**节点参数：**

- 字段名<font color=red>\*</font>：指从上游节点的输出参数中取哪个字段进行取值，此处填写字段名，若输出参数有多层结构，可使用 a.b.c 的格式获取，仅支持填写单个字段名，不支持多个字段。
- 分割符：指用来分割指定字段值的分割符，当指定字段值类型为字符串时才生效，默认分割符为英文逗号。

### 解析器节点

解析器节点主要用于解析上游节点的输出参数，根据用户填写的字段名，获取用户需要的参数值。解析完成后输出，输出的字段名为要解析的字段名。

**节点参数：**

- 解析参数<font color=red>\*</font>：指从上游节点的输出参数中获取哪些字段进行取值解析，此处填写字段名，若输出参数有多层结构，可使用 a.b.c 的格式获取，支持多个字段同时取值，多个字段之间使用英文逗号隔开。

> 解析器节点若要解析它上个节点的自定义参数，则字段名需要加上前缀`params.`。

### HTTP 请求节点

可以发送 HTTP 请求，支持各种请求类型，支持自定义请求参数、请求体、请求头等内容。用户可以使用此节点来发送请求以获得请求结果的数据，输出结果的字段名为`httpResult`。
目前本节点仅支持发送响应结果为 json 格式的请求，由于暂时没有渲染页面的功能，故而暂不支持响应网页内容的请求，例如百度等网页请求暂不支持。

**节点参数：**

- URL<font color=red>\*</font>：指要发送的请求 url 完整地址，通常以 http/https 开头；若当前要请求的接口是本项目平台创建的 HTTP 服务，则不需要填写域名，直接填写 url 路径即可。
- 请求方式<font color=red>\*</font>：指要发送请求的请求方式，例如 GET、POST 等，提供了几乎所有的请求方式可供用户选择。
- 请求参数：指请求 url 后面跟的请求参数，例如 id=xx 等，多个参数之间使用`&`分隔。
- 请求体：指发送请求的请求内容，长度不限，要求为 json 格式。
- 请求头：指发送请求的请求头参数，用户可以通过填写请求头来实现携带 token 等认证信息。默认`content-type: application/json`，用户可根据需求进行填写。

> 本节点目前仅支持结果为 json 格式的请求，暂不支持响应网页内容的请求。

### HTTP 接收节点

可以创建一个 HTTP 接口服务，用于接收 HTTP 请求。本节点为阻塞节点，节点运行后会在后台一直监听用户定义的请求。接收到对应的请求后，会获取请求参数和请求内容，解析后向下游输出。
便于处理用户自定义的业务逻辑，需要与[HTTP 响应]节点搭配使用，当处理完业务逻辑后，需要使用[HTTP 响应]节点来响应该请求。

**节点参数：**

- URL<font color=red>\*</font>：指要接收/监听的自定义请求 url 地址，此处不需要填写域名，直接填写 url 路径即可。
- 请求方式<font color=red>\*</font>：指要接收/监听的请求的请求方式，例如 GET、POST 等，提供了几乎所有的请求方式可供用户选择。

> 本项目平台规定不需要鉴权的请求路径以`/api/http/`开头。

### HTTP 响应节点

本节点主要用于响应 HTTP 请求，与[HTTP 接收]节点搭配使用，在收到请求、处理完业务逻辑后，本节点负责响应对应请求并返回数据。
用户可以自定义固定的响应内容，也可根据上游节点的输出结果来返回数据，响应请求。

**节点参数：**

- URL<font color=red>\*</font>：指要响应的请求 url 地址，此处不需要填写域名，直接填写 url 路径即可。
- 请求方式<font color=red>\*</font>：指要响应的请求的请求方式，例如 GET、POST 等，提供了几乎所有的请求方式可供用户选择。
- 响应数据：指固定的请求响应内容，不填则默认的响应内容为其上游节点的输出参数。

> [HTTP 响应]节点需要与[HTTP 接收]节点搭配使用，填写的参数也应一致。

### WS 服务端节点

WebSocket 服务端节点，用户可自定义请求路径创建 WebSocket 服务，自定义发送消息内容和发送时机，可广播发送上游节点的输出参数，收到客户端消息后亦会向下游输出。
本节点为阻塞节点，运行后会一直监听 WebSocket 消息。本节点可多次运行，由上游节点触发，用户可选择在节点每次运行时，将上游节点的输出参数广播发送出去。

**节点参数：**

- 路径<font color=red>\*</font>：指创建的 WebSocket 服务的 url 地址，此处不需要填写域名，直接填写 url 路径即可。
- 请求参数：指想要从接收到的 WebSocket 请求中获取到的参数名称，支持填写多个参数，以英文逗号分隔。
- 输出参数发送：指是否发送上游节点的输出参数，默认为不发送。若用户选择发送，则每次上游节点输出时，本节点都会进行 WebSocket 广播发送。
- 建立连接后发送：指每当有 WebSocket 客户端和本节点的服务端建立连接时，会向该客户端固定发送的消息内容，此处可使用占位符`${}`取请求参数中的字段值。
- 收到消息后发送：指每当收到来自 WebSocket 客户端的消息时，会向该客户端固定发送的消息内容。

> 本项目平台规定不需要鉴权的 WebSocket 请求路径以`/w/`开头。

### WS 客户端节点

WebSocket 客户端节点，可以连接指定路径的 websocket 服务，自定义发送消息内容和发送时机，收到服务端消息后会立即向下游输出。
本节点为阻塞节点，运行后与 WebSocket 服务端建立连接后，会一直监听服务端的消息。收到服务端的消息后，会向下输出消息内容，字段名为`message`。

**节点参数：**

- 路径<font color=red>\*</font>：指要连接的 WebSocket 服务的 url 地址，支持连接任何平台的 WebSocket 服务，通常以 ws/wss 开头。
  若要连接本项目平台创建的 WebSocket 服务，则不需要填写域名，直接填写 url 路径即可。url 路径支持使用`?`携带请求参数或 token 认证等。
- 建立连接后发送：指当前客户端与 WebSocket 服务端建立连接成功时，会向该服务端固定发送的消息内容。

### MQTT 订阅节点

MQTT 订阅节点，可订阅指定 MQTT 服务的指定 topic，每当接收到消息后，会将消息内容向下游输出，输出字段名为`message`。
本节点为阻塞节点，同一节点仅可运行一次，运行后会一直监听指定 topic。

**节点参数：**

- Client ID<font color=red>\*</font>：指当前 MQTT 客户端的 Client-ID，同一平台环境下，客户端 ID 不允许重复。
- 服务器地址<font color=red>\*</font>：采用域名填写+端口选择的方式，用户可便捷地定义要连接的 MQTT 服务器地址。
- Topic<font color=red>\*</font>：指用户需要订阅的 topic 主题，支持通配符。
- 用户名：连接到 MQTT 服务器所需要的认证身份信息，无需认证时则不用填写。
- 密码：连接到 MQTT 服务器所需要的认证身份信息，无需认证时则不用填写。

> 某个公网 MQTT 测试平台地址为` tcp://broker.emqx.io` `1883 `可供测试学习使用。

### MQTT 发布节点

MQTT 发布节点，可向指定 MQTT 服务的指定 topic 中发送自定义消息，发送出去的消息内容同时也会向下游节点输出，输出字段名为`message`。
本节点可多次重复运行，每次运行都会向指定 topic 中发送一次消息，消息发送完成后本节点就运行完成了。

**节点参数：**

- Client ID<font color=red>\*</font>：指当前 MQTT 客户端的 Client-ID，同一平台环境下，客户端 ID 不允许重复。
- 服务器地址<font color=red>\*</font>：采用域名填写+端口选择的方式，用户可便捷地定义要连接的 MQTT 服务器地址。
- Topic<font color=red>\*</font>：指用户需要发送消息的 topic 主题，支持通配符。
- 发送消息<font color=red>\*</font>：指用户想要发送的消息内容，字符串格式，支持使用占位符`${}`从上游节点的输出参数中取值。
- 用户名：连接到 MQTT 服务器所需要的认证身份信息，无需认证时则不用填写。
- 密码：连接到 MQTT 服务器所需要的认证身份信息，无需认证时则不用填写。

> 多次重复运行同一个本节点，后台会复用同一个 MQTT 连接，直至流程结束时断开连接。

### mysql 节点

Mysql 节点，可连接 mysql 数据库，执行自定义 sql 语句，支持任意类型的多条 sql 语句，输出每条语句的执行结果和内容
可连接 mysql 数据库，执行自定义 sql 语句，支持任意类型的多条 sql 语句，输出执行结果和内容

### mongodb 节点

MongoDB 节点，可连接 MongoDB 数据库，执行自定义命令语句，输出执行结果和内容
可连接 mongodb 数据库，执行自定义命令语句，输出执行结果和内容

### redis 节点

Redis 节点，可连接 redis 服务器，执行自定义操作，输出执行结果和内容
可连接 redis 服务器，执行自定义操作，输出执行结果和内容
